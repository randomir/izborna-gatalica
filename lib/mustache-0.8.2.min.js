(function(k,l){"object"===typeof exports&&exports?l(exports):"function"===typeof define&&define.amd?define(l({})):k.Mustache=l({})})(this,function(k){function l(a){return"function"===typeof a}function t(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function x(a,c){function b(a){"string"===typeof a&&(a=a.split(y,2));if(!u(a)||2!==a.length)throw Error("Invalid tags: "+a);f=RegExp(t(a[0])+"\\s*");q=RegExp("\\s*"+t(a[1]));m=RegExp("\\s*"+t("}"+a[1]))}if(!a)return[];var d=[],g=[],e=[],l=!1,
j=!1,f,q,m;b(c||k.tags);for(var i=new s(a),n,h,o,r;!i.eos();){n=i.pos;if(o=i.scanUntil(f)){r=0;for(var p=o.length;r<p;++r)if(h=o.charAt(r),!z.call(A,h)?e.push(g.length):j=!0,g.push(["text",h,n,n+1]),n+=1,"\n"===h){if(l&&!j)for(;e.length;)delete g[e.pop()];else e=[];j=l=!1}}if(!i.scan(f))break;l=!0;h=i.scan(B)||"name";i.scan(C);"="===h?(o=i.scanUntil(w),i.scan(w),i.scanUntil(q)):"{"===h?(o=i.scanUntil(m),i.scan(D),i.scanUntil(q),h="&"):o=i.scanUntil(q);if(!i.scan(q))throw Error("Unclosed tag at "+
i.pos);r=[h,o,n,i.pos];g.push(r);if("#"===h||"^"===h)d.push(r);else if("/"===h){h=d.pop();if(!h)throw Error('Unopened section "'+o+'" at '+n);if(h[1]!==o)throw Error('Unclosed section "'+h[1]+'" at '+n);}else"name"===h||"{"===h||"&"===h?j=!0:"="===h&&b(o)}if(h=d.pop())throw Error('Unclosed section "'+h[1]+'" at '+i.pos);return E(F(g))}function F(a){for(var c=[],b,d,g=0,e=a.length;g<e;++g)if(b=a[g])"text"===b[0]&&d&&"text"===d[0]?(d[1]+=b[1],d[3]=b[3]):(c.push(b),d=b);return c}function E(a){for(var c=
[],b=c,d=[],g,e=0,k=a.length;e<k;++e)switch(g=a[e],g[0]){case "#":case "^":b.push(g);d.push(g);b=g[4]=[];break;case "/":b=d.pop();b[5]=g[2];b=0<d.length?d[d.length-1][4]:c;break;default:b.push(g)}return c}function s(a){this.tail=this.string=a;this.pos=0}function m(a,c){this.view=null==a?{}:a;this.cache={".":this.view};this.parent=c}function p(){this.cache={}}var G=Object.prototype.toString,u=Array.isArray||function(a){return"[object Array]"===G.call(a)},z=RegExp.prototype.test,A=/\S/,H={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},C=/\s*/,y=/\s+/,w=/\s*=/,D=/\s*\}/,B=/#|\^|\/|>|\{|&|=|!/;s.prototype.eos=function(){return""===this.tail};s.prototype.scan=function(a){a=this.tail.match(a);if(!a||0!==a.index)return"";a=a[0];this.tail=this.tail.substring(a.length);this.pos+=a.length;return a};s.prototype.scanUntil=function(a){var a=this.tail.search(a),c;switch(a){case -1:c=this.tail;this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,a),this.tail=this.tail.substring(a)}this.pos+=
c.length;return c};m.prototype.push=function(a){return new m(a,this)};m.prototype.lookup=function(a){var c=this.cache,b;if(a in c)b=c[a];else{for(var d=this,g,e;d;){if(0<a.indexOf(".")){b=d.view;g=a.split(".");for(e=0;null!=b&&e<g.length;)b=b[g[e++]]}else b=d.view[a];if(null!=b)break;d=d.parent}c[a]=b}l(b)&&(b=b.call(this.view));return b};p.prototype.clearCache=function(){this.cache={}};p.prototype.parse=function(a,c){var b=this.cache,d=b[a];null==d&&(d=b[a]=x(a,c));return d};p.prototype.render=function(a,
c,b){var d=this.parse(a),c=c instanceof m?c:new m(c);return this.renderTokens(d,c,b,a)};p.prototype.renderTokens=function(a,c,b,d){function g(a){return m.render(a,c,b)}for(var e="",m=this,j,f,q=0,p=a.length;q<p;++q)switch(j=a[q],j[0]){case "#":f=c.lookup(j[1]);if(!f)continue;if(u(f))for(var i=0,n=f.length;i<n;++i)e+=this.renderTokens(j[4],c.push(f[i]),b,d);else if("object"===typeof f||"string"===typeof f)e+=this.renderTokens(j[4],c.push(f),b,d);else if(l(f)){if("string"!==typeof d)throw Error("Cannot use higher-order sections without the original template");
f=f.call(c.view,d.slice(j[3],j[5]),g);null!=f&&(e+=f)}else e+=this.renderTokens(j[4],c,b,d);break;case "^":f=c.lookup(j[1]);if(!f||u(f)&&0===f.length)e+=this.renderTokens(j[4],c,b,d);break;case ">":if(!b)continue;f=l(b)?b(j[1]):b[j[1]];null!=f&&(e+=this.renderTokens(this.parse(f),c,b,f));break;case "&":f=c.lookup(j[1]);null!=f&&(e+=f);break;case "name":f=c.lookup(j[1]);null!=f&&(e+=k.escape(f));break;case "text":e+=j[1]}return e};k.name="mustache.js";k.version="0.8.1";k.tags=["{{","}}"];var v=new p;
k.clearCache=function(){return v.clearCache()};k.parse=function(a,c){return v.parse(a,c)};k.render=function(a,c,b){return v.render(a,c,b)};k.to_html=function(a,c,b,d){a=k.render(a,c,b);if(l(d))d(a);else return a};k.escape=function(a){return(""+a).replace(/[&<>"'\/]/g,function(a){return H[a]})};k.Scanner=s;k.Context=m;k.Writer=p;return k});
